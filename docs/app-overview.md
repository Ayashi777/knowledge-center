# Функціональний опис додатку

Цей документ пояснює, як працює додаток «Corporate Knowledge Center» на рівні користувацьких сценаріїв, доступів, даних і ключових екранів. Мета — швидко зрозуміти функціонал без читання коду.

## 1) Що це за продукт

**Corporate Knowledge Center** — корпоративний портал для зберігання та видачі знань і документів із рольовим доступом (RBAC), пошуком, фільтрами та адміністративним керуванням контентом. Користувачі з різними ролями бачать різний набір документів та можливості (перегляд/завантаження).

Основні можливості:
- публічна/рольова база документів
- перегляд документа з превʼю та файлами
- складні фільтри (категорії, тип, ТМ, теги, ролі)
- адмін-панель для керування контентом, тегами, користувачами і заявками
- реєстрація з поданням заявки на роль
- підтримка двох мов (uk/en), фактично активна — українська
- підтримка світлої/темної теми

## 2) Ролі і доступи (RBAC)

Доступ визначається роллю користувача та правилами Firestore/Storage.

**Ролі:**
- `guest`, `foreman`, `engineer`, `architect`, `employee`, `worker`, `dispatcher`, `hr`, `admin`

**Основні принципи:**
- **Admin** має повний доступ до всіх документів, категорій, файлів і адмін-функцій.
- **View permissions**: якщо `viewPermissions` задані для документа — лише ці ролі можуть його бачити.
- Якщо `viewPermissions` порожні або відсутні — документ публічний (видимий всім, включно з guest).
- **Download permissions**: якщо `downloadPermissions` задані — лише ці ролі можуть скачувати файли. Якщо не задані — скачування успадковується від `viewPermissions`.

Це повторюється як в UI (перевірки доступу), так і в Firebase Rules.

## 3) Основні користувацькі сценарії

### 3.1 Гість (Guest)
- Бачить landing page з CTA на логін/реєстрацію.
- Може перейти в базу знань і бачити публічні документи.
- При спробі перегляду захищеного документа бачить екран доступу з вимогою логіну.

### 3.2 Зареєстрований користувач (не admin)
- Може увійти, бачити документи, доступні його ролі.
- Може фільтрувати документи по категоріях, тегах, типах тощо.
- Якщо документ має файли і дозволений download — може завантажити.

### 3.3 Адміністратор
- Доступ до `/admin`.
- Керує документами, категоріями, тегами.
- Керує користувачами та заявками на доступ.
- Може виправляти проблеми даних через Health Tab.

## 4) Структура UI по екранах

### 4.1 Landing Page (`/`)
Функції:
- маркетинговий опис продукту
- CTA на логін/реєстрацію
- тизери бази знань, сервісів, проектів
- FAQ

Ключові компоненти:
- `LandingPage` + підблоки `DatabaseTeaser`, `ServicesTeaser`, `ProjectsSection`

### 4.2 База знань (`/database`)
Функції:
- перегляд документів у grid/list вигляді
- фільтрація документів
- пагінація
- перегляд документа в модальному вікні

Основні блоки:
- `DashboardView` = `Sidebar` + `DashboardFilters` + `DocumentList`

Фільтри:
- Категорії (multi-select)
- Тип документа
- Торгова марка (TM)
- Ролі (for whom)
- Теги
- Пошук за назвою/описом

### 4.3 Сервіси (`/services`)
Функції:
- демонстрація сервісів компанії
- приклади та деталі по кожному сервісу
- drawer з прикладом

### 4.4 Калькулятори (`/calculators`)
Функції:
- каталог Excel/макросів для інженерних розрахунків
- фільтр за типом задач
- скачування файлів

### 4.5 Адмін-панель (`/admin`)
Функції:
- керування контентом
- керування тегами
- керування користувачами
- обробка заявок
- перевірка якості даних

Структура:
- `AdminPanel` з табами: `content`, `users`, `tags`, `requests`, `health`

## 5) Дані та моделі

### 5.1 Документ (`Document`)
Ключові поля:
- `id`, `title`, `description`, `extendedDescription`
- `categoryKey`
- `tagIds`
- `documentType`, `trademark`, `internalId`
- `viewPermissions`, `downloadPermissions`
- `status`: `draft | published | archived`

### 5.2 Категорія (`Category`)
- `nameKey` (ключ для i18n)
- `iconName`
- `viewPermissions`

### 5.3 Тег (`Tag`)
- `name`, `color`

### 5.4 Користувач (`UserProfile`)
- `uid`, `email`, `role`
- `company`, `phone`, `requestedRole`

## 6) Авторизація та заявки на доступ

### Логін
- Використовується Firebase Auth.

### Реєстрація
- Користувач створює акаунт і подає заявку на роль.
- Заявка записується у Firestore `requests`.

### Адмін обробляє заявки
- У табі `requests` можна схвалити чи відхилити.
- При схваленні роль оновлюється в `users`.

## 7) Робота з документами

### Перегляд
- Модалка `DocumentModal` показує preview, інформацію, список файлів.
- Якщо немає доступу — показується екран AccessDenied.

### Завантаження файлів
- Файли зберігаються в Firebase Storage.
- Доступ контролюється `downloadPermissions`.

### Адмін редагування
- `DocumentEditorModal` дозволяє редагувати метадані:
  - назва, опис, категорія
  - permissions (view/download)
  - теги
  - обкладинка

## 8) Адмін-функції

### Контент таб
- список категорій (редагування, видалення)
- список документів
- bulk-операції
- фільтри та збережені views

### Tags таб
- створення/редагування/видалення тегів
- колір тегу

### Users таб
- пошук користувачів
- редагування профілю
- зміна ролі

### Requests таб
- перегляд заявок
- approve/deny

### Health таб
- діагностика проблем:
  - документи без категорії
  - без тегів
  - биті теги
  - відсутні permissions
  - архівні без опису
- bulk-fix

## 9) Теми та локалізація

- `useTheme` управляє класом `dark` на `html`.
- i18next використовується для UI, активна мова `uk`.

## 10) Firebase Rules (безпека)

- Firestore rules обмежують доступ до `users`, `requests`, `documents`.
- Storage rules контролюють доступ до файлів на основі `viewPermissions` і `downloadPermissions`.

## 11) Візуальні тести

- Playwright робить скріншоти ключових екранів.
- Snapshot-и зберігаються у `tests/visual/...`.

---

## Якщо треба ще детальніше

Можна розширити документ:
1. Описати повний data flow (від UI → API → Firestore/Storage).
2. Додати діаграми (наприклад, Mermaid).
3. Розписати кожен модуль з props/станами/подіями.

Скажи, який рівень деталізації потрібен.
